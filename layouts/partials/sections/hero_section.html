{{- $site := .Site }}
{{- $section := .section }}
{{- $bg := $section.design.background }}
{{- $style := "" }}

{{- if $bg.color }}
{{- $style = printf "background-color: %s;" ($bg.color | default "transparent") }}
{{- end }}

{{- if and $bg.gradient_start $bg.gradient_end }}
{{- $style = printf "%sbackground-image: linear-gradient(%s, %s);" $style $bg.gradient_start $bg.gradient_end }}
{{- end }}

{{- if $bg.image }}
{{- $darken := "" }}
{{- if $bg.image_darken }}
{{- $darken = printf "linear-gradient(rgba(0, 0, 0, %s), rgba(0, 0, 0, %s))," (string $bg.image_darken) (string $bg.image_darken) }}
{{- end }}

{{- $imageResource := ($site.GetPage "/uploads").Resources.GetMatch (strings.TrimPrefix "/uploads/" ( $image | relURL )) }}
<!-- Aspect ratio 4:3 -->
{{- $resizedsm := $imageResource.Fill "640x480 center webp" }}
<!-- Aspect ratio 16:9 -->
{{- $resizedmd := $imageResource.Fill "768x432 webp" }}
{{- $resizedlg := $imageResource.Fill "1024x576 webp" }}
<!-- Aspect ratio 21:9 -->
{{- $resizedxl := $imageResource.Fill "1280x549 webp" }}
{{- $resized2xl := $imageResource.Fill "1536x658 webp" }}

{{- $style = printf "%sbackground-image: %s url('%s');" $style $darken (printf "img/%s" $bg.image | absURL) }}
{{- end }}

{{- with $section.design.spacing.padding }}
{{- $style_padding := printf "padding: %s;" (delimit . " ") }}
{{- $style = print $style $style_padding }}
{{- end }}

<div class="banner__image relative overflow-hidden transition-all duration-500 ease-ease" {{with $style}}style="{{ . | safeCSS}}"{{end}}>
    <div class="relative aspect-w-21 aspect-h-2">
        {{ with $bg.image }}
        {{ $include_dict := dict "image" . "Site" $site "resized" "1536x146 webp" "fill" true }}
        {{ partial "functions/get_image.html" $include_dict }}
        {{ end }}
        <div class="absolute w-full h-full left-0 top-0 flex items-end z-30">
            <header class="banner__header lg:w-1/2 relative px-3 lg:px-6 py-8 after:empty-content after:absolute after:w-12 after:h-2px after:bg-primary after:transition after:duration-500 after:ease-out">
                {{- with $section.title }}
                <h2 class="text-primary font-semibold text-base lg:text-xl uppercase leading-none mb-2">{{ . | safeHTML }}</h2>
                {{- end }}
                {{- with $section.subtitle }}
                <h4 class="text-secondary text-sm font-medium font-body leading-none mb-3">{{ . | safeHTML }}</h4>
                {{- end }}
            </header>
        </div>
    </div>
</div>
