<!doctype html>
<html lang="{{ with .Site.LanguageCode }}{{ . }}{{ else }}id{{ end }}">
    {{ partial "site_head.html" . }}
    <body x-data="{ darkMode: localStorage.getItem('dark') === 'true'} "
        x-init="$watch('darkMode', val => localStorage.setItem('dark', val))"
        x-bind:class="{ 'dark': darkMode }" :data-theme="darkMode ? 'dark' : 'light'" data-turbo-permanent>
        {{ partial "site_header.html" . }} 
        <div>  
        {{ block "content" . }}{{ end }}
        {{ partial "site_footer.html" . }}
        </div>
<script data-turbo-eval="false">
    document.addEventListener('turbo:before-render', () => {
        let permanents = document.querySelectorAll('[data-turbo-permanent]')

        let undos = Array.from(permanents).map(el => {
            el._x_ignore = true

            return () => {
                delete el._x_ignore
            }
        })

        document.addEventListener('turbo:render', function handler() {
            while(undos.length) undos.shift()()

            document.removeEventListener('turbo:render', handler)
        })
    })
</script>
    </body>
</html>